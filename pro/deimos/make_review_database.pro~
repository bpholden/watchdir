;+
; NAME:
;	MAKE_REVIEW_DATABASE
;
; PURPOSE:
;	This program will merge the indepdent files good.lst, bad.lst,
;	and review.lst into a single file review.dat
;
; CATEGORY:
;	IPM
;
; CALLING SEQUENCE:
;	make_review_database
;
; AUTHOR:
;	Gregory D. Wirth, W. M. Keck Observatory
;
; MODIFICATION HISTORY:
; 	2011-Nov-15	GDW	Original version
;-

;; define files...
thru_dir = getenv('DEIMOS_THRU_DIR')
if thru_dir eq '' then $
  message, 'DEIMOS_THRU_DIR is not defined -- abort!'
data_dir = thru_dir + '/dat/'
input_list   = data_dir + 'input.lst'
reject_list = data_dir + 'bad.lst'
approve_list = data_dir + 'good.lst'
review_list = data_dir + 'review.lst'
output_list = data_dir + 'review.db'

;; get input list...
result = read_csv( input_list)
all_files  = result.field1
n_files = n_elements(all_files)

;; get approved list...
readcol, approve_list, good_files, format='(a)'
n_good = n_elements(good_files)

;; get bad list...
result = read_csv(reject_list)
n_bad = n_elements(result)
bad_files = result.c1
bad_comment = result.c2

;; get review list...
result = read_csv(review_list)
n_review = n_elements(result)
review_files = result.c1
review_comment = result.c2

;; generate a struct...
a = {filename:'', comment:'', status:''}
data = replicate( a, n_files)

;; insert data into file...
for i=0,n_files-1 do begin

    filename = all_files[i]

    ;; insert filename...
    data[i].filename = filename

    ;; check for good...
    for j=0,n_good-1 do begin
        if good_files[j] eq filename then begin
            data[i].status = 'good'
        endif 
    endfor 

    ;; check for bad...
    for j=0,n_bad-1 do begin
        if bad_files[j] eq filename then begin
            data[i].status = 'bad'
            data[i].comment = bad_comment[j]
        endif 
    endfor 

    ;; check for review...
    for j=0,n_review-1 do begin
        if review_files[j] eq filename then begin
            data[i].status = 'review'
            data[i].comment = review_comment[j]
        endif 
    endfor 
endfor 

;; save file...
write_csv, output_list, data

end
